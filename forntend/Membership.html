<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Membership - Elmvale Horticultural Society</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script defer src="navbar.js"></script>
</head>

<body>
  <!-- Navbar -->
  <div id="navbar-container"></div>

  <!-- Membership Page Banner -->
  <section class="position-relative overflow-hidden" style="max-height: 500px">
    <img src="assets/images/Annual Meeting-Nov 2024-1.jpg" class="w-100" style="
          object-fit: cover;
          object-position: center;
          height: 100%;
          max-height: 500px;
        " alt="Membership" />
    <div class="position-absolute top-50 start-50 translate-middle text-center text-white"
      style="text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.6)">
      <h1 class="fw-bold" style="font-size: 2.8rem">Membership</h1>
      <p class="lead" style="font-size: 1.1rem">
        Join us and grow with our gardening community
      </p>
    </div>
  </section>

  <!-- Membership Form -->
  <section class="py-5 container">
    <h1>Membership Application Form</h1>

    <div class="card p-4 shadow-sm bg-white">
      <h3 class="mb-3">E.D.G.E. (Elmvale District Garden Enthusiasts)</h3>

      <form id="membershipForm" novalidate>
        <div class="mb-3">
          <label for="fullName" class="form-label">Name (print neatly)</label>
          <input type="text" class="form-control" id="fullName" name="fullName" />
          <div class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label for="address" class="form-label">Address</label>
          <input type="text" class="form-control" id="address" name="address" />
          <div class="invalid-feedback"></div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="postalCode" class="form-label">Postal Code</label>
            <input type="text" class="form-control" id="postalCode" name="postalCode" />
            <div class="invalid-feedback"></div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="phone" class="form-label">Phone #</label>
            <input type="text" class="form-control" id="phone" name="phone" />
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">E-mail Address</label>
          <input type="email" class="form-control" id="email" name="email" />
          <div class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label class="form-label me-3" for="membershipType">Membership Type:</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="newMember" name="membershipType" value="New"
              checked="true" />
            <label class="form-check-label" for="newMember">New</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="renewingMember" name="membershipType" value="Renewing" />
            <label class="form-check-label" for="renewingMember">Renewing</label>
          </div>
        </div>

        <div class="mb-3">
          <label for="membershipFee"><strong>Membership Fee:</strong> Single $15 per year</label>
          <input type="hidden" id="membershipFee" value="15" />
          <p>
            Cheques are made payable to:
            <strong>Elmvale and District Horticultural Society</strong>
          </p>
        </div>

        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="acceptConstitution" />
          <label class="form-check-label" for="acceptConstitution">I have read the Constitution and Code of
            Conduct</label>
          <div class="invalid-feedback d-block" id="constitutionError"></div>
        </div>

        <h5>Photo Release Permission and Photo Waiver</h5>
        <p>
          Participants involved in any activities offered by E.D.G.E. may be
          photographed or videotaped during events. The undersigned consents
          to the use of these photos and/or videos without compensation on
          E.D.G.E.â€™s social media and promotional materials.
        </p>

        <div class="mb-3">
          <label for="signature" class="form-label">Signature</label>
          <input type="text" class="form-control" id="signature" name="signature" />
          <div class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label for="printedName" class="form-label">Name Printed Neatly</label>
          <input type="text" class="form-control" id="printedName" name="printedName" />
          <div class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label for="date" class="form-label">Date</label>
          <input type="date" class="form-control" id="date" name="date" />
          <div class="invalid-feedback"></div>
        </div>

        <button type="submit" class="btn btn-success">Submit & Download PDF</button>
        <small class="text-muted d-block mt-2">Please print this page and bring it to the meeting with the
          payment.</small>
      </form>
    </div>
  </section>

  <!-- Footer -->
  <div id="footer-container"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="footer.js"></script>
  <script>
    document.getElementById("membershipForm").addEventListener("submit", async function (event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // Handle radio & checkbox manually
      data.membershipType = form.querySelector("input[name='membershipType']:checked")?.value || "";
      data.agreedToCode = document.getElementById("acceptConstitution").checked;

      // Clear previous errors
      form.querySelectorAll(".is-invalid").forEach(el => el.classList.remove("is-invalid"));
      form.querySelectorAll(".invalid-feedback").forEach(el => el.textContent = "");
      document.getElementById("constitutionError").textContent = "";

      let hasError = false;

      function showError(id, message) {
        const field = document.getElementById(id);
        field.classList.add("is-invalid");
        field.nextElementSibling.textContent = message;
        hasError = true;
      }

      // Validation
      if (!data.fullName.trim()) showError("fullName", "Full Name is required.");
      if (!data.address.trim()) showError("address", "Address is required.");
      if (!data.postalCode.trim()) showError("postalCode", "Postal Code is required.");
      if (!data.phone.trim()) showError("phone", "Phone number is required.");
      if (!data.email.trim()) showError("email", "Email is required.");
      if (!data.agreedToCode) {
        document.getElementById("constitutionError").textContent = "You must agree to the Constitution.";
        hasError = true;
      }
      if (!data.signature.trim()) showError("signature", "Signature is required.");
      if (!data.printedName.trim()) showError("printedName", "Printed name is required.");
      if (!data.date.trim()) showError("date", "Date is required.");

      if (hasError) return;

      try {
        const response = await fetch("http://localhost:3000/api/membership/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          // If response is a PDF blob, download it
          const contentType = response.headers.get("Content-Type");
          if (contentType && contentType.includes("application/pdf")) {
            const blob = await response.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "Membership_Form.pdf";
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
            form.reset();
            alert("Form submitted and downloaded successfully!");
          } else {
            const result = await response.json();
            alert(result.message || "Form submitted successfully!");
          }
        } else {
          const errorData = await response.json();
          alert("Error: " + (errorData.message || "Submission failed."));
        }

      } catch (err) {
        alert("Something went wrong: " + err.message);
      }
    });
  </script>

</body>

</html>